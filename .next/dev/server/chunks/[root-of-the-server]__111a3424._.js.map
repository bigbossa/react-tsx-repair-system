{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Computer/Desktop/pm2_Suacess_Mark1/app/react-tsx-repair-system/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg'\r\n\r\n// User Login Database (useryc)\r\nconsole.log('User Database Configuration:', {\r\n  host: process.env.DBLG_HOST,\r\n  port: process.env.DBLG_PORT,\r\n  database: process.env.DBLG_NAME,\r\n  user: process.env.DBLG_USER,\r\n  passwordSet: !!process.env.DBLG_PASSWORD\r\n})\r\n\r\nconst poolLogin = new Pool({\r\n  host: process.env.DBLG_HOST,\r\n  port: parseInt(process.env.DBLG_PORT || '5432'),\r\n  database: process.env.DBLG_NAME,\r\n  user: process.env.DBLG_USER,\r\n  password: process.env.DBLG_PASSWORD,\r\n  connectionTimeoutMillis: 10000,\r\n  idleTimeoutMillis: 30000,\r\n  max: 10,\r\n})\r\n\r\n// Repair Request Database (RepairRequest)\r\nconsole.log('Repair Database Configuration:', {\r\n  host: process.env.DBRE_HOST,\r\n  port: process.env.DBRE_PORT,\r\n  database: process.env.DBRE_NAME,\r\n  user: process.env.DBRE_USER,\r\n  passwordSet: !!process.env.DBRE_PASSWORD\r\n})\r\n\r\nconst poolRepair = new Pool({\r\n  host: process.env.DBRE_HOST,\r\n  port: parseInt(process.env.DBRE_PORT || '5432'),\r\n  database: process.env.DBRE_NAME,\r\n  user: process.env.DBRE_USER,\r\n  password: process.env.DBRE_PASSWORD,\r\n  connectionTimeoutMillis: 10000,\r\n  idleTimeoutMillis: 30000,\r\n  max: 10,\r\n})\r\n\r\n// Test connections on startup\r\npoolLogin.on('connect', () => {\r\n  console.log('User Database connected successfully')\r\n})\r\n\r\npoolLogin.on('error', (err) => {\r\n  console.error('Unexpected user database error:', err)\r\n})\r\n\r\npoolRepair.on('connect', () => {\r\n  console.log('Repair Database connected successfully')\r\n})\r\n\r\npoolRepair.on('error', (err) => {\r\n  console.error('Unexpected repair database error:', err)\r\n})\r\n\r\nexport async function query(text: string, params?: any[]) {\r\n  const start = Date.now()\r\n  try {\r\n    const res = await poolLogin.query(text, params)\r\n    const duration = Date.now() - start\r\n    console.log('Query executed successfully', { duration, rows: res.rowCount })\r\n    return res\r\n  } catch (error) {\r\n    console.error('Database query error:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function queryRepair(text: string, params?: any[]) {\r\n  const start = Date.now()\r\n  try {\r\n    const res = await poolRepair.query(text, params)\r\n    const duration = Date.now() - start\r\n    console.log('Repair DB Query executed successfully', { duration, rows: res.rowCount })\r\n    return res\r\n  } catch (error) {\r\n    console.error('Repair database query error:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport { poolLogin as default, poolRepair }\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,+BAA+B;AAC/B,QAAQ,GAAG,CAAC,gCAAgC;IAC1C,IAAI;IACJ,IAAI;IACJ,QAAQ;IACR,IAAI;IACJ,aAAa,CAAC;AAChB;AAEA,MAAM,YAAY,IAAI,4GAAI,CAAC;IACzB,IAAI;IACJ,MAAM,SAAS,4CAAyB;IACxC,QAAQ;IACR,IAAI;IACJ,QAAQ;IACR,yBAAyB;IACzB,mBAAmB;IACnB,KAAK;AACP;AAEA,0CAA0C;AAC1C,QAAQ,GAAG,CAAC,kCAAkC;IAC5C,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,UAAU,QAAQ,GAAG,CAAC,SAAS;IAC/B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,aAAa,CAAC,CAAC,QAAQ,GAAG,CAAC,aAAa;AAC1C;AAEA,MAAM,aAAa,IAAI,4GAAI,CAAC;IAC1B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,MAAM,SAAS,QAAQ,GAAG,CAAC,SAAS,IAAI;IACxC,UAAU,QAAQ,GAAG,CAAC,SAAS;IAC/B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,UAAU,QAAQ,GAAG,CAAC,aAAa;IACnC,yBAAyB;IACzB,mBAAmB;IACnB,KAAK;AACP;AAEA,8BAA8B;AAC9B,UAAU,EAAE,CAAC,WAAW;IACtB,QAAQ,GAAG,CAAC;AACd;AAEA,UAAU,EAAE,CAAC,SAAS,CAAC;IACrB,QAAQ,KAAK,CAAC,mCAAmC;AACnD;AAEA,WAAW,EAAE,CAAC,WAAW;IACvB,QAAQ,GAAG,CAAC;AACd;AAEA,WAAW,EAAE,CAAC,SAAS,CAAC;IACtB,QAAQ,KAAK,CAAC,qCAAqC;AACrD;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,UAAU,KAAK,CAAC,MAAM;QACxC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,+BAA+B;YAAE;YAAU,MAAM,IAAI,QAAQ;QAAC;QAC1E,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAEO,eAAe,YAAY,IAAY,EAAE,MAAc;IAC5D,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,WAAW,KAAK,CAAC,MAAM;QACzC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,yCAAyC;YAAE;YAAU,MAAM,IAAI,QAAQ;QAAC;QACpF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM;IACR;AACF"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Computer/Desktop/pm2_Suacess_Mark1/app/react-tsx-repair-system/app/api/company/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { queryRepair } from \"@/lib/db\"\r\n\r\n// GET - ดึงข้อมูล company ทั้งหมด\r\nexport async function GET(request: Request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const id = searchParams.get('id')\r\n\r\n    if (id) {\r\n      // ดึงข้อมูล company ตาม ID\r\n      const result = await queryRepair(\r\n        \"SELECT * FROM company WHERE id = $1\",\r\n        [id]\r\n      )\r\n      \r\n      if (result.rows.length === 0) {\r\n        return NextResponse.json(\r\n          { error: \"ไม่พบข้อมูลบริษัท\" },\r\n          { status: 404 }\r\n        )\r\n      }\r\n      \r\n      return NextResponse.json(result.rows[0])\r\n    } else {\r\n      // ดึงข้อมูล company ทั้งหมด เรียงตามชื่อ\r\n      const result = await queryRepair(\r\n        \"SELECT * FROM company ORDER BY company_name ASC\"\r\n      )\r\n      \r\n      return NextResponse.json(result.rows)\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Database error:\", error)\r\n    return NextResponse.json(\r\n      { error: \"เกิดข้อผิดพลาดในการดึงข้อมูล\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// POST - เพิ่ม company ใหม่\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const body = await request.json()\r\n    const { company_code, company_name } = body\r\n\r\n    // ตรวจสอบข้อมูลที่จำเป็น\r\n    if (!company_code || !company_name) {\r\n      return NextResponse.json(\r\n        { error: \"กรุณากรอกรหัสและชื่อบริษัท\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // ตรวจสอบว่ารหัสซ้ำหรือไม่\r\n    const checkCode = await queryRepair(\r\n      \"SELECT * FROM company WHERE company_code = $1\",\r\n      [company_code]\r\n    )\r\n\r\n    if (checkCode.rows.length > 0) {\r\n      return NextResponse.json(\r\n        { error: \"รหัสบริษัทนี้มีอยู่ในระบบแล้ว\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const result = await queryRepair(\r\n      `INSERT INTO company (company_code, company_name, created_at, updated_at) \r\n       VALUES ($1, $2, NOW(), NOW()) \r\n       RETURNING *`,\r\n      [company_code, company_name]\r\n    )\r\n\r\n    return NextResponse.json(\r\n      { message: \"เพิ่มบริษัทสำเร็จ\", data: result.rows[0] },\r\n      { status: 201 }\r\n    )\r\n  } catch (error) {\r\n    console.error(\"Database error:\", error)\r\n    return NextResponse.json(\r\n      { error: \"เกิดข้อผิดพลาดในการเพิ่มข้อมูล\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// PUT - แก้ไขข้อมูล company\r\nexport async function PUT(request: Request) {\r\n  try {\r\n    const body = await request.json()\r\n    const { id, company_code, company_name } = body\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: \"ไม่พบ ID ของบริษัท\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // ตรวจสอบว่า company มีอยู่จริง\r\n    const checkResult = await queryRepair(\r\n      \"SELECT * FROM company WHERE id = $1\",\r\n      [id]\r\n    )\r\n\r\n    if (checkResult.rows.length === 0) {\r\n      return NextResponse.json(\r\n        { error: \"ไม่พบข้อมูลบริษัท\" },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    // ตรวจสอบรหัสซ้ำ (ยกเว้นตัวเอง)\r\n    const checkCode = await queryRepair(\r\n      \"SELECT * FROM company WHERE company_code = $1 AND id != $2\",\r\n      [company_code, id]\r\n    )\r\n\r\n    if (checkCode.rows.length > 0) {\r\n      return NextResponse.json(\r\n        { error: \"รหัสบริษัทนี้มีอยู่ในระบบแล้ว\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const result = await queryRepair(\r\n      `UPDATE company \r\n       SET company_code = $1, company_name = $2, updated_at = NOW() \r\n       WHERE id = $3 \r\n       RETURNING *`,\r\n      [company_code, company_name, id]\r\n    )\r\n\r\n    return NextResponse.json({\r\n      message: \"แก้ไขข้อมูลสำเร็จ\",\r\n      data: result.rows[0]\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Database error:\", error)\r\n    return NextResponse.json(\r\n      { error: \"เกิดข้อผิดพลาดในการแก้ไขข้อมูล\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// DELETE - ลบ company\r\nexport async function DELETE(request: Request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const id = searchParams.get('id')\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: \"ไม่พบ ID ของบริษัท\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // ตรวจสอบว่า company มีอยู่จริง\r\n    const checkResult = await queryRepair(\r\n      \"SELECT * FROM company WHERE id = $1\",\r\n      [id]\r\n    )\r\n\r\n    if (checkResult.rows.length === 0) {\r\n      return NextResponse.json(\r\n        { error: \"ไม่พบข้อมูลบริษัท\" },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    await queryRepair(\"DELETE FROM company WHERE id = $1\", [id])\r\n\r\n    return NextResponse.json({\r\n      message: \"ลบบริษัทสำเร็จ\"\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Database error:\", error)\r\n    return NextResponse.json(\r\n      { error: \"เกิดข้อผิดพลาดในการลบข้อมูล\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}