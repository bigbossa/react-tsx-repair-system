{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Computer/Desktop/pm2_Suacess_Mark1/app/react-tsx-repair-system/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg'\r\n\r\n// User Login Database (useryc)\r\nconsole.log('User Database Configuration:', {\r\n  host: process.env.DBLG_HOST,\r\n  port: process.env.DBLG_PORT,\r\n  database: process.env.DBLG_NAME,\r\n  user: process.env.DBLG_USER,\r\n  passwordSet: !!process.env.DBLG_PASSWORD\r\n})\r\n\r\nconst poolLogin = new Pool({\r\n  host: process.env.DBLG_HOST,\r\n  port: parseInt(process.env.DBLG_PORT || '5432'),\r\n  database: process.env.DBLG_NAME,\r\n  user: process.env.DBLG_USER,\r\n  password: process.env.DBLG_PASSWORD,\r\n  connectionTimeoutMillis: 10000,\r\n  idleTimeoutMillis: 30000,\r\n  max: 10,\r\n})\r\n\r\n// Repair Request Database (RepairRequest)\r\nconsole.log('Repair Database Configuration:', {\r\n  host: process.env.DBRE_HOST,\r\n  port: process.env.DBRE_PORT,\r\n  database: process.env.DBRE_NAME,\r\n  user: process.env.DBRE_USER,\r\n  passwordSet: !!process.env.DBRE_PASSWORD\r\n})\r\n\r\nconst poolRepair = new Pool({\r\n  host: process.env.DBRE_HOST,\r\n  port: parseInt(process.env.DBRE_PORT || '5432'),\r\n  database: process.env.DBRE_NAME,\r\n  user: process.env.DBRE_USER,\r\n  password: process.env.DBRE_PASSWORD,\r\n  connectionTimeoutMillis: 10000,\r\n  idleTimeoutMillis: 30000,\r\n  max: 10,\r\n})\r\n\r\n// Test connections on startup\r\npoolLogin.on('connect', () => {\r\n  console.log('User Database connected successfully')\r\n})\r\n\r\npoolLogin.on('error', (err) => {\r\n  console.error('Unexpected user database error:', err)\r\n})\r\n\r\npoolRepair.on('connect', () => {\r\n  console.log('Repair Database connected successfully')\r\n})\r\n\r\npoolRepair.on('error', (err) => {\r\n  console.error('Unexpected repair database error:', err)\r\n})\r\n\r\nexport async function query(text: string, params?: any[]) {\r\n  const start = Date.now()\r\n  try {\r\n    const res = await poolLogin.query(text, params)\r\n    const duration = Date.now() - start\r\n    console.log('Query executed successfully', { duration, rows: res.rowCount })\r\n    return res\r\n  } catch (error) {\r\n    console.error('Database query error:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function queryRepair(text: string, params?: any[]) {\r\n  const start = Date.now()\r\n  try {\r\n    const res = await poolRepair.query(text, params)\r\n    const duration = Date.now() - start\r\n    console.log('Repair DB Query executed successfully', { duration, rows: res.rowCount })\r\n    return res\r\n  } catch (error) {\r\n    console.error('Repair database query error:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport { poolLogin as default, poolRepair }\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,+BAA+B;AAC/B,QAAQ,GAAG,CAAC,gCAAgC;IAC1C,IAAI;IACJ,IAAI;IACJ,QAAQ;IACR,IAAI;IACJ,aAAa,CAAC;AAChB;AAEA,MAAM,YAAY,IAAI,4GAAI,CAAC;IACzB,IAAI;IACJ,MAAM,SAAS,4CAAyB;IACxC,QAAQ;IACR,IAAI;IACJ,QAAQ;IACR,yBAAyB;IACzB,mBAAmB;IACnB,KAAK;AACP;AAEA,0CAA0C;AAC1C,QAAQ,GAAG,CAAC,kCAAkC;IAC5C,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,UAAU,QAAQ,GAAG,CAAC,SAAS;IAC/B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,aAAa,CAAC,CAAC,QAAQ,GAAG,CAAC,aAAa;AAC1C;AAEA,MAAM,aAAa,IAAI,4GAAI,CAAC;IAC1B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,MAAM,SAAS,QAAQ,GAAG,CAAC,SAAS,IAAI;IACxC,UAAU,QAAQ,GAAG,CAAC,SAAS;IAC/B,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,UAAU,QAAQ,GAAG,CAAC,aAAa;IACnC,yBAAyB;IACzB,mBAAmB;IACnB,KAAK;AACP;AAEA,8BAA8B;AAC9B,UAAU,EAAE,CAAC,WAAW;IACtB,QAAQ,GAAG,CAAC;AACd;AAEA,UAAU,EAAE,CAAC,SAAS,CAAC;IACrB,QAAQ,KAAK,CAAC,mCAAmC;AACnD;AAEA,WAAW,EAAE,CAAC,WAAW;IACvB,QAAQ,GAAG,CAAC;AACd;AAEA,WAAW,EAAE,CAAC,SAAS,CAAC;IACtB,QAAQ,KAAK,CAAC,qCAAqC;AACrD;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,UAAU,KAAK,CAAC,MAAM;QACxC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,+BAA+B;YAAE;YAAU,MAAM,IAAI,QAAQ;QAAC;QAC1E,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAEO,eAAe,YAAY,IAAY,EAAE,MAAc;IAC5D,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,WAAW,KAAK,CAAC,MAAM;QACzC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,yCAAyC;YAAE;YAAU,MAAM,IAAI,QAAQ;QAAC;QACpF,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM;IACR;AACF"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Computer/Desktop/pm2_Suacess_Mark1/app/react-tsx-repair-system/lib/auth-store.ts"],"sourcesContent":["import { query } from './db'\n\n// Database user authentication - NO FALLBACK\nexport async function authenticateUser(username: string, password: string) {\n  console.log('Authenticating user from database:', username)\n  \n  try {\n    // Query user from database - Role: 0 = Admin, 1 = User\n    const result = await query(\n      'SELECT iduser, usersname as username, site, username as user_login, password, department, userid, \"Role\" FROM useryc WHERE username = $1 AND password = $2 LIMIT 1',\n      [username, password]\n    )\n\n    console.log('Query returned', result.rows.length, 'rows')\n\n    if (result.rows.length === 0) {\n      console.log('Invalid credentials - user not found')\n      return null\n    }\n\n    const user = result.rows[0]\n    console.log('User authenticated:', { username: user.user_login, role: user.Role })\n    \n    // Map database user to application format\n    const userData = {\n      id: user.userid?.toString() || user.iduser?.toString() || '1',\n      username: user.user_login,\n      email: `${user.user_login}@system.local`,\n      role: (user.Role === 0) ? 'admin' : 'user',\n      name: user.username || user.user_login,\n      site: user.site || '00',\n      department: user.department || '',\n    }\n    \n    return userData\n  } catch (error) {\n    console.error('Database authentication failed:', error)\n    if (error instanceof Error) {\n      console.error('Error:', error.message)\n    }\n    throw error\n  }\n}\n\nexport async function getUserByUsername(username: string) {\n  try {\n    const result = await query(\n      'SELECT iduser, usersname as username, site, username as user_login, department, userid, \"Role\" FROM useryc WHERE username = $1 LIMIT 1',\n      [username]\n    )\n\n    if (result.rows.length === 0) {\n      return null\n    }\n\n    const user = result.rows[0]\n    \n    return {\n      id: user.userid?.toString() || user.iduser?.toString() || '1',\n      username: user.user_login,\n      email: `${user.user_login}@system.local`,\n      role: (user.Role === 0) ? 'admin' : 'user',\n      name: user.username || user.user_login,\n      site: user.site || '00',\n      department: user.department || '',\n    }\n  } catch (error) {\n    console.error('Get user error:', error)\n    throw error\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAGO,eAAe,iBAAiB,QAAgB,EAAE,QAAgB;IACvE,QAAQ,GAAG,CAAC,sCAAsC;IAElD,IAAI;QACF,uDAAuD;QACvD,MAAM,SAAS,MAAM,IAAA,+JAAK,EACxB,sKACA;YAAC;YAAU;SAAS;QAGtB,QAAQ,GAAG,CAAC,kBAAkB,OAAO,IAAI,CAAC,MAAM,EAAE;QAElD,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YAC5B,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;QAEA,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAC3B,QAAQ,GAAG,CAAC,uBAAuB;YAAE,UAAU,KAAK,UAAU;YAAE,MAAM,KAAK,IAAI;QAAC;QAEhF,0CAA0C;QAC1C,MAAM,WAAW;YACf,IAAI,KAAK,MAAM,EAAE,cAAc,KAAK,MAAM,EAAE,cAAc;YAC1D,UAAU,KAAK,UAAU;YACzB,OAAO,GAAG,KAAK,UAAU,CAAC,aAAa,CAAC;YACxC,MAAM,AAAC,KAAK,IAAI,KAAK,IAAK,UAAU;YACpC,MAAM,KAAK,QAAQ,IAAI,KAAK,UAAU;YACtC,MAAM,KAAK,IAAI,IAAI;YACnB,YAAY,KAAK,UAAU,IAAI;QACjC;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,IAAI,iBAAiB,OAAO;YAC1B,QAAQ,KAAK,CAAC,UAAU,MAAM,OAAO;QACvC;QACA,MAAM;IACR;AACF;AAEO,eAAe,kBAAkB,QAAgB;IACtD,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,+JAAK,EACxB,0IACA;YAAC;SAAS;QAGZ,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YAC5B,OAAO;QACT;QAEA,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAE3B,OAAO;YACL,IAAI,KAAK,MAAM,EAAE,cAAc,KAAK,MAAM,EAAE,cAAc;YAC1D,UAAU,KAAK,UAAU;YACzB,OAAO,GAAG,KAAK,UAAU,CAAC,aAAa,CAAC;YACxC,MAAM,AAAC,KAAK,IAAI,KAAK,IAAK,UAAU;YACpC,MAAM,KAAK,QAAQ,IAAI,KAAK,UAAU;YACtC,MAAM,KAAK,IAAI,IAAI;YACnB,YAAY,KAAK,UAAU,IAAI;QACjC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,MAAM;IACR;AACF"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Computer/Desktop/pm2_Suacess_Mark1/app/react-tsx-repair-system/app/api/auth/login/route.ts"],"sourcesContent":["import { authenticateUser } from \"@/lib/auth-store\"\nimport { type NextRequest, NextResponse } from \"next/server\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { username, password } = await request.json()\n\n    const user = await authenticateUser(username, password)\n\n    if (!user) {\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 })\n    }\n\n    return NextResponse.json(user)\n  } catch (error) {\n    console.error('Login API error:', error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjD,MAAM,OAAO,MAAM,IAAA,qLAAgB,EAAC,UAAU;QAE9C,IAAI,CAAC,MAAM;YACT,OAAO,2LAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,OAAO,2LAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,2LAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}